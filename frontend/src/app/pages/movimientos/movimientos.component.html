<section class="card border-0 shadow-sm p-4">
  <header class="d-flex flex-column gap-3 mb-4">
    <p class="form-label fw-semibold mb-0">Filtros de búsqueda</p>
    <div class="row g-2">
      <div class="col-12 col-md-6 col-lg-4">
        <label class="form-label small mb-1" for="filtro-nombre-producto">Producto</label>
        <input
          type="text"
          id="filtro-nombre-producto"
          class="form-control form-control-sm"
          placeholder="Nombre del producto"
          [(ngModel)]="filtroNombreProducto"
          (keyup.enter)="aplicarFiltros()"
        />
      </div>
      <div class="col-12 col-md-4 col-lg-2">
        <label class="form-label small mb-1" for="filtro-tipo">Tipo</label>
        <select class="form-select form-select-sm" id="filtro-tipo" [(ngModel)]="filtroTipo">
          <option value="">Todos</option>
          <option value="ENTRADA">Entrada</option>
          <option value="SALIDA">Salida</option>
          <option value="VENTA">Venta</option>
        </select>
      </div>
      <div class="col-12 col-md-4 col-lg-3">
        <label class="form-label small mb-1" for="filtro-desde">Desde</label>
        <input id="filtro-desde" type="date" class="form-control form-control-sm" [(ngModel)]="filtroDesde" />
      </div>
      <div class="col-12 col-md-4 col-lg-3">
        <label class="form-label small mb-1" for="filtro-hasta">Hasta</label>
        <input id="filtro-hasta" type="date" class="form-control form-control-sm" [(ngModel)]="filtroHasta" />
      </div>
    </div>
    <div class="d-flex flex-column flex-md-row gap-2 justify-content-md-end">
      <button
        type="button"
        class="btn btn-primary btn-sm d-flex align-items-center justify-content-center gap-2"
        (click)="aplicarFiltros()"
      >
        <i class="bi bi-search"></i>
        <span>Buscar</span>
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center gap-2"
        (click)="limpiarFiltros()"
      >
        <i class="bi bi-arrow-counterclockwise"></i>
        <span>Reiniciar</span>
      </button>
    </div>
  </header>

  <div class="alert alert-primary d-flex align-items-center gap-2" *ngIf="estado === 'cargando'">
    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    <span class="fw-semibold mb-0">Cargando movimientos...</span>
  </div>

  <div class="alert alert-danger" *ngIf="estado === 'error'">
    <span class="fw-semibold d-block mb-1">Error al cargar.</span>
    <span class="mb-0">No pudimos obtener los movimientos del kardex. Intenta nuevamente.</span>
  </div>

  <div class="alert alert-secondary" *ngIf="estado === 'listo' && !hayMovimientos">
    <span class="mb-0">No hay movimientos para los filtros aplicados.</span>
  </div>

  <div class="table-responsive" *ngIf="estado === 'listo' && hayMovimientos">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead class="table-light text-uppercase text-muted small">
        <tr>
          <th scope="col">Producto</th>
          <th scope="col">Tipo</th>
          <th scope="col" class="text-end">Cantidad</th>
          <th scope="col">Usuario</th>
          <th scope="col">Comentario</th>
          <th scope="col" class="text-end">Fecha</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let movimiento of movimientos">
          <td>
            <div class="fw-semibold text-uppercase">{{ movimiento.productoNombre }}</div>
          </td>
          <td>
            <span class="badge" [ngClass]="{
                'text-bg-success-subtle text-success': movimiento.tipo === 'ENTRADA',
                'text-bg-danger-subtle text-danger': movimiento.tipo === 'SALIDA',
                'text-bg-warning-subtle text-warning': movimiento.tipo === 'VENTA'
              }">
              {{ movimiento.tipo }}
            </span>
          </td>
          <td class="text-end fw-semibold">
            {{ movimiento.tipo === 'ENTRADA' ? '+' : movimiento.tipo === 'SALIDA' ? '-' : '' }}{{ movimiento.cantidad }}
          </td>
          <td>
            <div class="fw-semibold">{{ movimiento.usuarioNombre }}</div>
          </td>
          <td>
            {{ movimiento.tipo === 'SALIDA' ? (movimiento.comentario || 'Sin comentario') : '—' }}
          </td>
          <td class="text-end">
            <div class="fw-semibold">{{ movimiento.fechaRegistro | date: 'mediumDate' }}</div>
            <small class="text-muted">{{ movimiento.fechaRegistro | date: 'shortTime' }}</small>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <nav
    class="d-flex justify-content-end mt-3"
    *ngIf="estado === 'listo' && mostrarPaginador"
    aria-label="Paginación de movimientos"
  >
    <ul class="pagination pagination-sm mb-0">
      <li class="page-item" [class.disabled]="paginaActual === 0">
        <button class="page-link" type="button" (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 0">
          Anterior
        </button>
      </li>
      <li class="page-item" *ngFor="let pagina of paginas" [class.active]="pagina === paginaActual">
        <button class="page-link" type="button" (click)="cambiarPagina(pagina)">
          {{ pagina + 1 }}
        </button>
      </li>
      <li class="page-item" [class.disabled]="paginaActual === totalPaginas - 1">
        <button class="page-link" type="button" (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual === totalPaginas - 1">
          Siguiente
        </button>
      </li>
    </ul>
  </nav>
</section>
